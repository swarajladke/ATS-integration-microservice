service: ats-integration-microservice

frameworkVersion: '3'

provider:
  name: aws
  runtime: python3.11
  stage: ${opt:stage, 'dev'}
  region: ${opt:region, 'us-east-1'}
  memorySize: 256
  timeout: 30
  
  environment:
    ATS_PROVIDER: ${env:ATS_PROVIDER, 'greenhouse'}
    ATS_API_KEY: ${env:ATS_API_KEY, ''}
    ATS_BASE_URL: ${env:ATS_BASE_URL, ''}
    ZOHO_CLIENT_ID: ${env:ZOHO_CLIENT_ID, ''}
    ZOHO_CLIENT_SECRET: ${env:ZOHO_CLIENT_SECRET, ''}
    ZOHO_REFRESH_TOKEN: ${env:ZOHO_REFRESH_TOKEN, ''}
    ZOHO_REGION: ${env:ZOHO_REGION, 'com'}
    WORKABLE_API_KEY: ${env:WORKABLE_API_KEY, ''}
    WORKABLE_SUBDOMAIN: ${env:WORKABLE_SUBDOMAIN, ''}
    LOG_LEVEL: ${env:LOG_LEVEL, 'INFO'}

  httpApi:
    cors:
      allowedOrigins:
        - '*'
      allowedHeaders:
        - Content-Type
        - Authorization
      allowedMethods:
        - GET
        - POST
        - OPTIONS

functions:
  getJobs:
    handler: src/handlers/jobs.get_jobs
    description: Fetch all open jobs from the ATS
    events:
      - httpApi:
          path: /jobs
          method: GET

  createCandidate:
    handler: src/handlers/candidates.create_candidate
    description: Create a new candidate and attach to a job
    events:
      - httpApi:
          path: /candidates
          method: POST

  getApplications:
    handler: src/handlers/applications.get_applications
    description: Fetch applications for a specific job
    events:
      - httpApi:
          path: /applications
          method: GET

plugins:
  - serverless-offline
  - serverless-python-requirements

custom:
  pythonRequirements:
    dockerizePip: false
    slim: true
    strip: false
  
  serverless-offline:
    httpPort: 3000
    lambdaPort: 3002
    noPrependStageInUrl: true

package:
  individually: false
  patterns:
    - '!node_modules/**'
    - '!.git/**'
    - '!tests/**'
    - '!docs/**'
    - '!.env*'
    - '!*.md'
    - 'src/**'
